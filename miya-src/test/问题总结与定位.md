# 问题清单与具体定位

## 当前状态
- 截至 2026-02-19，本文件原列问题已全部修复并回归通过。
- 当前未复现阻断级问题。

## 已修复问题（含定位）

1. `opencode debug config/skill` schema 报错
- 修复定位: `miya-src/opencode.json`
- 修复内容: 改为 OpenCode config schema（`https://opencode.ai/config.json`）并使用 `plugin` 配置。

2. 分类测试脚本空目录失败
- 修复定位:
  - `miya-src/test/integration/integration-smoke.test.ts`
  - `miya-src/test/regression/regression-bridge.test.ts`
  - `miya-src/test/adversarial/adversarial-bridge.test.ts`
  - `miya-src/test/performance/performance-smoke.test.ts`
  - `miya-src/test/e2e/e2e-smoke.test.ts`
- 修复内容: 补齐 5 个分类目录测试入口，脚本可执行。

3. 覆盖率脚本 reporter 不兼容 Bun
- 修复定位: `miya-src/package.json`
- 修复内容: `test:coverage`、`test:coverage:core` 从 `html` 改为 `text + lcov`。

4. 集成报告脚本失败（runtime 超时/daemon_ws_closed）
- 修复定位: `miya-src/tools/run-integration-suite.ts`
- 修复内容: 统一执行 `test/integration`，增加 timeout，默认使用 `MIYA_MULTIMODAL_TEST_MODE=1` 冒烟路径，报告稳定生成。

5. `doc:lint` 与 `opencode.json` 新口径冲突
- 修复定位: `miya-src/tools/doc-lint.ts`
- 修复内容: 当 `opencode.json` 为 config schema 时，跳过 manifest 字段校验。

6. Lint 告警
- 修复定位: 多文件（含 `src/cli/index.ts`, `src/daemon/host.ts`, `src/daemon/launcher.ts`, `src/router/learner.ts`, `src/companion/sqlite-runtime.ts`, `src/index.ts`, `src/gateway/index.ts` 等）
- 修复内容: 清理可选链、三元表达式、未使用符号、non-null assertion、`any` 类型等告警。

## 回归命令（全部通过）
- `opencode debug config`
- `opencode debug skill`
- `opencode debug paths`
- `bun run typecheck`
- `bun run lint`
- `bun run doc:lint`
- `bun run check:contracts`
- `bun run check:no-regression`
- `bun run test`
- `bun run test:unit`
- `bun run test:integration`
- `bun run test:regression`
- `bun run test:adversarial`
- `bun run test:performance`
- `bun run test:e2e`
- `bun run test:coverage`
- `bun run test:coverage:core`
- `bun run test:integration:report`
- `bun run test:ci`
